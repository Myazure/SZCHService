<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.milestone.mygeo.dao.ILayoutPointDao">
    
    <insert id="insertLayoutPoint" parameterType="LayoutPoint">
     insert into layout_point(father_layout,point_pic) 
            values(#{father_layout},#{point_pic}) 
        <selectKey keyProperty="point_id" resultType="int" order="AFTER" >
			SELECT LAST_INSERT_ID()
		</selectKey>  
	</insert>
	
	
	<insert id="addPointParamList" useGeneratedKeys="true" parameterType="java.util.List">  
	     
	    insert into point_param (father_point, param_name, param_code ,param_type, is_input, is_select, is_must, is_light, is_memory, remark, param_length, father_param,is_operate,order_num)   
	    values  
	    <foreach collection="list" item="PointParam" index="index" separator="," >  
	        (#{PointParam.father_point}, #{PointParam.param_name}, #{PointParam.param_code}, #{PointParam.param_type}, #{PointParam.is_input}, #{PointParam.is_select}, #{PointParam.is_must}, #{PointParam.is_light}, #{PointParam.is_memory}, #{PointParam.remark}, #{PointParam.param_length}, #{PointParam.father_param}, #{PointParam.is_operate}, #{PointParam.order_num})
	    </foreach>  
	</insert> 
	
	
	<update id="updateLayoutPoint" parameterType="LayoutPoint" >  
	    update layout_point  
	    <set >  
	      <if test="point_pic != null" >  
	        point_pic = #{point_pic},  
	      </if>              
	    </set>  
	    where point_id = #{point_id}  
	</update>
	

	<select id="selectPointByLayout"  resultType="LayoutPoint" parameterType="int">
		select * from layout_point where father_layout = #{father_layout} and is_del=0
    </select>
	

    <select id="getPointParams"  resultType="PointParam" parameterType="PointParam">
		select * from point_param where father_point = #{father_point} and (param_name = #{param_name} or param_code = #{param_code}) and is_del=0
    </select>
    
    <insert id="addPointParam"  parameterType="PointParam">  
	     
	    insert into point_param (father_point, param_name, param_code ,param_type, is_input, is_select, is_must, is_light, is_memory, remark, param_length,father_param,is_operate,order_num)   
	    	values  (#{father_point}, #{param_name}, #{param_code}, #{param_type}, #{is_input}, #{is_select}, #{is_must}, #{is_light}, #{is_memory}, #{remark}, #{param_length}, #{father_param}, #{is_operate}, #{order_num})
 		<selectKey keyProperty="point_paramid" resultType="int" order="AFTER" >
			SELECT LAST_INSERT_ID()
		</selectKey> 
	</insert> 
	
	<update id="updatePointParam" parameterType="PointParam" >  
	    update point_param  
	    <set >  
	      <if test="param_name != null" >  
	        param_name = #{param_name},  
	      </if>   
	      <if test="param_code != null" >  
	        param_code = #{param_code},  
	      </if>    
	      param_type = #{param_type},  
	      is_input = #{is_input},  
	      is_select = #{is_select},  
	      is_must = #{is_must},
	      is_light = #{is_light},  
	      is_memory = #{is_memory},  
	      remark = #{remark},  
	      param_length = #{param_length},  
	      father_param = #{father_param},         
	    </set>  
	    where point_paramid = #{point_paramid}  
	</update>
	
	
	<select id="getPointParamsByPoint"  resultType="PointParam" parameterType="int">
		select * from point_param where father_point = #{father_point} and is_del=0 order by order_num
    </select>
    
    
    
    <insert id="addPointParamSet" parameterType="PointParamSet">
     insert into point_param_set(point_paramid,name,value,pic_path) 
            values(#{point_paramid},#{name},#{value},#{pic_path}) 
        <selectKey keyProperty="id" resultType="int" order="AFTER" >
			SELECT LAST_INSERT_ID()
		</selectKey>  
	</insert>
    
	
    <update id="updatePointParamSet" parameterType="PointParamSet" >  
	    update point_param_set  
	    <set >  
	      <if test="name != null" >  
	        name = #{name},  
	      </if>   
	      <if test="value != null" >  
	        value = #{value},  
	      </if>   
	      <if test="pic_path != null" >  
	        pic_path = #{pic_path},  
	      </if>            
	    </set>  
	    where id = #{id}  
	</update>
	
		
	<select id="getPointParamSetsByParamId"  resultType="PointParamSet" parameterType="int">
		select * from point_param_set where point_paramid = #{point_paramid} and is_del=0
    </select>
    
    <select id="getPointParamByParamId"  resultType="PointParam" parameterType="int">
		select * from point_param where point_paramid = #{point_paramid} and is_del=0
    </select>
    
    
    <update id="deletePointParamSetById"  parameterType="int" >
		update point_param_set set is_del=1 where id = #{id} 
    </update>
    
	<update id="deletePointParamByParamId"  parameterType="int" >
		update point_param set is_del=1 where point_paramid = #{point_paramid} 
    </update>
    
    <update id="deletePointParamSetByParamId"  parameterType="int" >
		update point_param_set set is_del=1 where point_paramid = #{point_paramid} 
    </update>
    
    <update id="deletePointByPointId"  parameterType="int" >
		update layout_point set is_del=1 where point_id = #{point_id} 
    </update>
    
    <update id="updatePointParamOrderUp"  parameterType="PointParam" >
		update point_param set order_num = order_num-1 where father_point = #{father_point} and is_del=0 and order_num > #{order_num} 
    </update>
    
    <update id="updatePointParamOrder"  parameterType="PointParam" >
		update point_param set order_num = #{order_num} where point_paramid = #{point_paramid} 
    </update>
</mapper>

